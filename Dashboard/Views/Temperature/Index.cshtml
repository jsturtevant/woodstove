@model Dashboard.Models.DevicesViewModel

@{
    ViewBag.Title = "Temprature";
}

<div class="devices row">
    @foreach (var device in @Model.Devices)
    {
        <div class="col col-sm-4 text-center">
            <div class="device">
                <h1 class="">@device.Name</h1>
                <div class="loading">
                    Loading<br />
                    <i class="fa fa-cog fa-spin"></i>
                </div>
             

                <div class="temprature-display">
                    <span id="temp">

                    </span>

                    <canvas class="hide" id="mycanvas" width="400" height="100"></canvas>
                </div>
            </div>
        </div>
    }
</div>

@section scripts
{
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script src="~/Scripts/smoothie.js"></script>

    <script>
        $(function () {
            var smoothie = new SmoothieChart();
            smoothie.streamTo(document.getElementById("mycanvas"));
            var line1 = new TimeSeries();
            smoothie.addTimeSeries(line1);

            // Declare a proxy to reference the hub.
            var tempHub = $.connection.tempHub;
            var currentDevice;

            tempHub.client.currentTemp = function (temp) {
                $('#temp').html(temp);
                line1.append(new Date().getTime(), temp);
            };

            $.connection.hub.start();
        });
    </script>
}